<!DOCTYPE html>
<html lang = "en">
    <head>
        <meta charset = "UTF-8">
        <title>calculator app</title>
        <link rel ="stylesheet" href="style.css">
        <link rel ="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    </head>
    <body>

        <div class = "calculator">
            <div class="display-wrapper">
                <div class="working"></div>
                <div class = "display">0</div>
            </div>
            <div class="topRow">
                <button class = "backBtn"> <i class="fa-solid fa-delete-left"></i> </button>
            </div>
            <div class="row">
                <button class = "clearBtn">AC</button>
                <button class = "operatorBtn" data-action = "รท">/</button>
            </div>
            <div class="row">
                <button class="numberBtn">7</button>
                <button class="numberBtn">8</button>
                <button class="numberBtn">9</button>
                <button class = "operatorBtn" data-action = "x">x</button>
            </div>
            <div class="row">
                <button class="numberBtn">4</button>
                <button class="numberBtn">5</button>
                <button class="numberBtn">6</button>
                <button class = "operatorBtn" data-action = "-">-</button>
            </div>
            <div class="row">
                <button class="numberBtn">1</button>
                <button class="numberBtn">2</button>
                <button class="numberBtn">3</button>
                <button class = "operatorBtn" data-action = "+">+</button>
            </div>
            <div class="row">
                <button class="numberBtn">0</button>
                <button class="numberBtn">.</button>
                <button class="resultBtn">=</button>
            </div>
        </div>

        <script>

            let result = 0;
            let firstNumber = 0;
            let secondNumber = 0;
            let currentOperator;
            let lastBtnPressed;

            let memory = [];

            const regex = /รทx-+/g

            const display = document.querySelector('.display');
            const workingDisplay = document.querySelector('.working');

            const buttons = document.querySelectorAll('button');

            
            const populateDisplay = function populateDisplay(){
                if (this.classList.contains('clearBtn')){
                    display.textContent = '0'; 
                    workingDisplay.textContent = '';
                    memory = [];
                    firstNumber = 0; 
                    return
                }
                else if (this.classList.contains('numberBtn')){
                        if (lastBtnPressed === 'operatorBtn' || lastBtnPressed === 'resultBtn'){
                            display.textContent = '';
                        }
                        if (display.textContent === '0' && this.textContent !== '.'){
                            display.textContent = `${this.textContent}`;
                        }
                        else {
                            if (this.textContent === '.' && display.textContent.includes('.') === false){
                                    display.textContent+= '.';
                                    console.log('hi');
                                }
                            else if (display.textContent.length <= 19 && this.textContent !== '.'){
                                display.textContent += this.textContent;
                            }                     
                        }
                        firstNumber = display.textContent;
                        secondNumber = display.textContent;
                     }
                else if (this.classList.contains('operatorBtn')){
                    if (lastBtnPressed === 'operatorBtn'){
                        return
                    }
                    memory.push(firstNumber);
                    currentOperator = `${this.dataset.action}`;
                    memory.push(currentOperator);
                }
                else if (this.classList.contains('resultBtn')){
                    if (lastBtnPressed === 'resultBtn'){
                        return
                    }
                    memory.push(secondNumber);
                    memory.splice(-0, memory.length - 3);
                    if (memory[1] === 'x' || memory[1] === 'รท' || memory[1] === '+' || memory[1] === '-'){
                        result = operate(memory[0], memory[1], memory[2]);
                    display.textContent = `= ${result}`;
                    firstNumber = `${result}`;
                    workingDisplay.textContent = memory.join(' ')
                    }
                }
                memory.splice(-0, memory.length - 3);
                lastBtnPressed = this.className;

            }

            function add(a, b){
                return parseInt(a) + parseInt(b);
            }

            function subtract(a, b){
                return a - b;
            }

            function multiply(a, b){
                return a * b;
            }

            function divide(a, b){
                return a / b;
            }

            function operate(firstNumber, operator, secondNumber){

                if (operator === '+'){
                    return add(firstNumber, secondNumber);
                }
                if (operator === '-'){
                    return subtract(firstNumber, secondNumber);
                }
                if (operator === 'x'){
                    return multiply(firstNumber, secondNumber);
                }
                if (operator === 'รท'){
                    return divide(firstNumber, secondNumber);
                }
            }

            buttons.forEach((button) => button.addEventListener('click', populateDisplay));
        </script>
    </body>
</html>